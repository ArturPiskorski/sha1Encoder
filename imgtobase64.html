<!DOCTYPE html>
<html>
  <head>
    <title>GitHub Pages API</title>
    <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js" type="text/javascript"></script>
    <script>
      ThunkableWebviewerExtension.receiveMessage(function(receivedData) {
        try {
          var imageUrl = receivedData;
          convertImageToBase64(imageUrl);
        } catch (error) {
          handleError(error);
        }
      });

      function convertImageToBase64(imageUrl) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", imageUrl, true);
        xhr.responseType = "blob";

        xhr.onload = function() {
          if (xhr.status === 200) {
            var reader = new FileReader();
            reader.onloadend = function() {
              var base64String = reader.result;
              ThunkableWebviewerExtension.postMessage(base64String);
            };
            reader.readAsDataURL(xhr.response);
          } else {
            var error = new Error("Nie można załadować obrazu. Kod odpowiedzi: " + xhr.status);
            handleError(error);
          }
        };

        xhr.onerror = function() {
          var error = new Error("Wystąpił błąd podczas pobierania obrazu.");
          handleError(error);
        };

        xhr.send();
      }

      function handleError(error) {
        var errorMessage = "ERROR: " + error.message;
        if (error instanceof DOMException) {
          errorMessage += " Kod błędu: " + error.code;
        }
        ThunkableWebviewerExtension.postMessage(errorMessage);
        console.error(error); // Wyświetl błąd w konsoli przeglądarki dla dodatkowych informacji diagnostycznych
      }
    </script>
  </head>
  <body>
    <!-- Dodaj elementy HTML swojej strony -->
  </body>
</html>
