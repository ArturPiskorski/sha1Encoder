<!DOCTYPE html>
<html>
  <head>
    <title>GitHub Pages API</title>
    <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js" type="text/javascript"></script>
    <script>
      ThunkableWebviewerExtension.receiveMessage(function(receivedData) {
        try {
          var imageUrl = receivedData;
          convertImageToBase64(imageUrl);
        } catch (error) {
          handleError(error);
        }
      });

      function convertImageToBase64(imageUrl) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
          var reader = new FileReader();
          reader.onloadend = function() {
            var base64String = reader.result;
            ThunkableWebviewerExtension.postMessage(base64String);
          };
          reader.readAsDataURL(xhr.response);
        };
        xhr.onerror = function() {
          var error = new Error("Nie można załadować obrazu.");
          handleError(error);
        };
        xhr.open("GET", imageUrl);
        xhr.responseType = "blob";
        xhr.send();
      }

      function handleError(error) {
        ThunkableWebviewerExtension.postMessage("ERROR: " + error.message);
      }
    </script>
  </head>
  <body></body>
</html>
